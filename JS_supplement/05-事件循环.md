## 事件循环

事件循环（`eventLoop`）是单线程的JavaScript在处理异步事件时进行的一种循环过程，具体来讲，对于异步事件它会先加入到事件队列中挂起，等主线程空闲时会去执行事件队列中的事件。

### 一、浏览器的进程模型

#### 1. 进程

程序的运行需要内存空间，为了防止内存泄漏、内存占用，计算机会给程序分配专属的内存空间，可以把这块内存空间理解为进程。

当我们启动某个程序时，操作系统会给该程序创建一块内存(当程序关闭时，该内存空间就会被回收)，用来存放代码、运行中程序，这样的一个运行环境就叫进程。

- 进程与进程之间完全隔离，互不干扰，一个进程崩溃不会影响其他进程，避免一个进程出错影响整个程序

#### 2. 线程

进程中的一个执行任务（控制单元），负责当前进程中程序的执行。一个进程至少有一个线程，一个进程可以运行多个线程，多个线程可共享数据。

一个进程至少有一个线程，在进程开启后就会自动创建一个线程来运行代码，该线程称为主线程。

如果程序需要同时执行多块代码，主线程就会启动更多的线程来执行代码，所以一个进程中可以包含多个线程。

#### 3. 浏览器的进程和线程

浏览器是一个多进程多线程的应用程序，为了避免互相影响，减少连环崩溃的几率，浏览器会自动启动多个进程。

可以在 `任务管理器` 中查看浏览器当前进程：

<img src=".\image\05-1.png" alt="05-1" style="zoom:50%;" />

浏览器进程中最主要的有：

1. 浏览器进程

   主要负责界面显示、**用户交互**、子进程管理等。浏览器进程内部会启动多个线程处理不同的任务。

   界面显示指的是浏览器本身的界面，比如导航栏、工具栏、收藏按钮等等，不是网页页面的展示。

2. 网络进程

   负责加载网络资源，网络进程内部会启动多个线程处理不同的任务。

3. 渲染进程

   渲染进程启动后，会开启一个**渲染主线程**，主线程负责执行 HTML、CSS、JS 代码。

   默认情况下，浏览器会为每个标签页开启一个新的渲染进程，以保证不同标签页之间互不影响。

   渲染进程的渲染主线程和前端息息相关，需要重要理解。



### 二、渲染主线程

渲染主线程是浏览器中最繁忙的线程，需要处理的任务包括但不限于：

- 解析 HTML、CSS
- 计算样式
- 布局
- 处理图层
- 执行 JS 代码
- 执行事件处理函数
- 执行计时器的回调函数

> 为什么渲染进程不用多个线程来分别处理这些任务？

要处理这些复杂任务，主线程要如何调度这些任务？

比如：

- 浏览器正在执行一个 JS 函数，执行到一半时用户点击了按钮，要立刻去执行点击事件的处理函数吗？
- 浏览器正在执行一个 JS 函数，执行到一半时某个计时器到达了时间，要立刻执行其回调吗？
- 浏览器进程同时监听到了点击事件和计时器停止，要先执行哪一个？

渲染主线程使用**消息队列**来处理调度问题。

<img src="E:\Note\Frontend\JS_supplement\image\05-2.png" alt="05-2" style="zoom:60%;" />

[并发模型与事件循环 - JavaScript | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Event_loop)
